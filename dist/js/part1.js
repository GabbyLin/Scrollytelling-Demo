"use strict";$(function(){var t,e,l=1200<window.innerWidth?(t=600,e=500,15):window.innerWidth<=1200&&767<window.innerWidth?(t=500,e=400,7):(t=280,e=200,5),r=document.querySelectorAll(".sticky");Stickyfill.add(r);var d=[0],u=0;$(".explain").each(function(t,e){1023<window.innerWidth?t<4?d.push($(this).offset().top-500):d.push($(this).offset().top-200):d.push($(this).offset().top-450)}),console.log(d);var a=20,s=20,n=30,o=40,p=t-o-s,h=e-a-n,y=d3.scaleLinear().range([0,p]),m=d3.scaleLinear().range([h,0]),f=["#366EE4","#85D3A0","#F29B09","#FFE365","#CF9D51","#FBBE01","#D4006E","#A62100","#777A7F","#3562A5","#88BC76","#2B8491","#575757","transparent"],w=d3.axisBottom(y),C=d3.axisLeft(m),k=d3.select("#scatterplot").attr("width",p+o+s).attr("height",h+a+n).append("g").attr("transform","translate("+o+","+a+")"),v=[],x=[],g=[],b=[];d3.tsv("api/p1-1-partyVote.tsv",function(t,e){if(t)throw t;e.forEach(function(t){t.year=+t.year,t.partyVotePercent=+t.partyVotePercent,v.push({party:t.party,year:t.year,partyVotePercent:t.partyVotePercent}),b.push(t)}),b.push({party:"fake",year:2017,partyVotePercent:.35});for(var r=0;r<v.length;r++){var a=v[r].party;"kmt"!==a&&"dpp"!==a||x.push(v[r]),"kmt"!==a&&"dpp"!==a&&g.push(v[r])}function s(){return d3.axisLeft(m).ticks(5)}console.log(x),console.log(g),y.domain(d3.extent(b,function(t){return t.year})).nice(),m.domain(d3.extent(v,function(t){return t.partyVotePercent})).nice();k.append("g").attr("class","grid horizon").attr("transform","translate(0,"+h+")").call(d3.axisBottom(y).ticks(5).tickSize(-h).tickFormat(""));var n=k.append("g").attr("class","grid vertical").call(s().tickSize(-p).tickFormat(""));k.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")").call(w.tickFormat(d3.format("d")).tickValues([2008,2012,2016])).append("text").attr("class","label").attr("x",p).attr("y",-6).style("text-anchor","end").text("Sepal Width (cm)");k.append("g").attr("class","y axis").call(C.tickFormat(d3.format(".0%"))).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Sepal Length (cm)"),k.selectAll(".dot").data(v).enter().append("circle").attr("class","dot").attr("r",l).attr("cx",function(t){return y(t.year)}).attr("cy",function(t){return m(t.partyVotePercent)}).attr("data-year",function(t){return t.year}).attr("data-party",function(t){return t.party}).style("fill",function(t,e){if(!(0<t.partyVotePercent))return f[13];switch(t.party){case"kmt":return f[0];case"dpp":return f[1];case"peopleFirst":return f[2];case"newParty":return f[3];case"unionParty":return f[4];case"newPower":return f[5];case"nonPartisan":return f[6];case"numberOne":return f[7];case"independent":return f[8];case"minkuotang":return f[9];case"greenParty":return f[10];case"faithHope":return f[11];case"healthFree":return f[12]}}),d3.line().x(function(t){return y(t.year)}).y(function(t){return m(t.partyVotePercent)}).curve(d3.curveStepBefore),d3.line().x(function(t){return y(t.year)}).y(function(t){return m(t.partyVotePercent)}),k.append("path").style("stroke","#2ecc71").style("stroke-width","1px").style("fill","none").style("opacity",0),k.append("path").style("stroke","#2ecc71").style("stroke-width","1px").style("fill","none").style("opacity",0);var o,i=!1;var c=_.throttle(function(){o=window.scrollY||window.pageYOffset,i||window.requestAnimationFrame(function(){!function(r){switch($.each(d,function(t,e){0<=t&&(t>d.length-2?r>d[t]&&(u=t):r>d[t]&&r<=d[t+1]&&(u=t))}),u){case 1:$(".multipleChart").eq(0).addClass("show"),$(".multipleChart").eq(1).removeClass("show"),$(".multipleChart").eq(2).removeClass("show");break;case 2:$(".multipleChart").eq(0).removeClass("show"),$(".multipleChart").eq(1).addClass("show"),$(".multipleChart").eq(2).removeClass("show");break;case 3:$(".multipleChart").eq(0).removeClass("show"),$(".multipleChart").eq(1).removeClass("show"),$(".multipleChart").eq(2).addClass("show");break;case 4:m.domain(d3.extent(v,function(t){return t.partyVotePercent})).nice(),k.select(".y").transition().duration(500).call(C.tickFormat(d3.format(".0%"))),k.selectAll(".dot").transition().duration(500).attr("cy",function(t){return m(t.partyVotePercent)}),$("#group-show-2").removeClass("show"),$("#group-show-1").addClass("show"),$(".subsidy").removeClass("show");break;case 5:m.domain(d3.extent(g,function(t){return t.partyVotePercent})).nice(),k.select(".y").transition().duration(500).call(C.tickFormat(d3.format(".0%"))),k.selectAll(".dot").transition().duration(500).attr("cy",function(t){return m(t.partyVotePercent)}),n.call(s().tickSize(-p).tickFormat("")),$("#group-show-1").removeClass("show"),$("#group-show-2").addClass("show"),$(".subsidy").removeClass("show");break;case 6:$(".subsidy").addClass("show"),$(".subsidy2").removeClass("show");break;case 7:$(".subsidy").removeClass("show"),$(".subsidy2").addClass("show"),$(".subsidy3").removeClass("show");break;case 8:$(".subsidy2").removeClass("show"),$(".subsidy3").addClass("show")}console.log("scroll_pos:"+r+" nowIndex:"+u)}(o),i=!1}),i=!0},0);window.addEventListener("scroll",c)})});